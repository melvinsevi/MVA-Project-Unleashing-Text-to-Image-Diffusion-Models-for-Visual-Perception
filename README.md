# Referring Image Segmentation via Text-to-Image Diffusion Models

Welcome to our project repository! Here, we present our efforts to enhance the referring image segmentation task within the VPD model. Our approach involves refining the original model by incorporating a frozen diffusion module while experimenting with different levels of noise added to the input image. We delve into visualizing the attention maps generated by the model, offering valuable insights for potential improvements in future research endeavors. This README provides comprehensive instructions on setting up and running the codebase.

## Setting Up the Environment

Before running the code, install the requirements:

```bash

%cd VPD2/refer
pip install -r requirements.txt

%cd VPD2/stablediffusion
pip install -r requirements.txt
```

Training the Frozen VPD Model with Added Noise Scale
Run the following command to start training the frozen VPD model with a specific noise scale value. Note that you can modify the noise scale value directly in the model file within the model_refer folder.
We choosed the same parameters that we choose for training.

```bash

python VPD2/refer/my_train.py --dataset refcoco --split val --epochs 1 --batch-size 4 --workers 4 --img_size 512
```

Running Inference with Specified Checkpoints
After training, perform inference with a specified checkpoint as follows:

```bash
python VPD2/refer/my_test.py --dataset refcoco --split val --epochs 1 --workers 4 --img_size 512

```

<div style="text-align:center;">
    <img src="https://github.com/melvinsevi/MVA-Project-Unleashing-Text-to-Image-Diffusion-Models-for-Visual-Perception/blob/main/VPDgit.png?raw=true" alt="Alt Text" width="450"/>
</div>

Here is the attention maps obtained in inference, when varying the noise added to the input image of the model:

<div style="text-align:center;">
    <img src="https://github.com/melvinsevi/MVA-Project-Unleashing-Text-to-Image-Diffusion-Models-for-Visual-Perception/blob/main/VPD2/VPD_img.png?raw=true" alt="Alt Text" width="450"/>
</div> 
